# База данных и система аутентификации

## Архитектура

Проект использует Firebase для реализации базы данных и аутентификации. Firebase предоставляет полный набор инструментов для разработки веб-приложений, включая:

- **Firebase Authentication** - система аутентификации с поддержкой различных провайдеров (Email/Password, Google, и др.)
- **Cloud Firestore** - NoSQL база данных для хранения данных в реальном времени
- **Firebase Hosting** - хостинг для развертывания приложения

## Структура базы данных

База данных Cloud Firestore организована вокруг нескольких ключевых коллекций:

### users

Коллекция содержит информацию о пользователях приложения.

| Поле | Тип | Описание |
|------|-----|----------|
| uid | string | ID пользователя (соответствует ID в Firebase Auth) |
| email | string | Email пользователя |
| displayName | string | Отображаемое имя пользователя |
| photoURL | string (null) | URL аватара пользователя |
| createdAt | timestamp | Дата и время создания аккаунта |
| wallet | object | Информация о крипто-кошельке пользователя |
| wallet.address | string | Адрес кошелька |
| wallet.balance | number | Баланс кошелька |
| wallet.isConnected | boolean | Подключен ли кошелек |
| wallet.lastUpdated | timestamp | Время последнего обновления информации о кошельке |

### orders

Содержит информацию о заказах на покупку NFT.

| Поле | Тип | Описание |
|------|-----|----------|
| id | string | Уникальный идентификатор заказа |
| userId | string | ID пользователя, создавшего заказ |
| nftId | string | ID NFT, связанного с заказом |
| nftName | string | Название NFT |
| totalPrice | number | Общая стоимость заказа |
| status | string | Статус заказа (pending, completed, cancelled) |
| createdAt | timestamp | Дата и время создания заказа |
| completedAt | timestamp (null) | Дата и время завершения заказа |

### participations

Содержит информацию об участиях пользователей в различных проектах.

| Поле | Тип | Описание |
|------|-----|----------|
| id | string | Уникальный идентификатор участия |
| userId | string | ID пользователя |
| projectId | string | ID проекта |
| amount | number | Сумма вложений |
| share | number | Процент участия в проекте |
| status | string | Статус участия (active, completed) |
| createdAt | timestamp | Дата и время создания записи |
| updatedAt | timestamp | Дата и время последнего обновления |

### nfts

Содержит информацию о NFT токенах в системе.

| Поле | Тип | Описание |
|------|-----|----------|
| id | string | Уникальный идентификатор NFT |
| name | string | Название NFT |
| description | string | Описание NFT |
| imageUrl | string | URL изображения NFT |
| price | number | Цена токена |
| ownerId | string | ID владельца NFT (null для маркетплейса) |
| tokenId | string | ID токена в блокчейне |
| contractAddress | string | Адрес смарт-контракта |
| metadata | object | Дополнительные метаданные NFT |
| createdAt | timestamp | Дата и время создания NFT |

### revenues

Содержит информацию о доходах пользователей.

| Поле | Тип | Описание |
|------|-----|----------|
| id | string | Уникальный идентификатор записи |
| userId | string | ID пользователя |
| amount | number | Сумма дохода |
| source | string | Источник дохода (project, nft, referral) |
| sourceId | string | ID источника дохода |
| createdAt | timestamp | Дата и время создания записи |
| description | string | Описание дохода |

### transactions

Содержит информацию о транзакциях пользователей.

| Поле | Тип | Описание |
|------|-----|----------|
| id | string | Уникальный идентификатор транзакции |
| userId | string | ID пользователя |
| type | string | Тип транзакции (purchase, investment, withdrawal, deposit) |
| amount | number | Сумма транзакции |
| status | string | Статус транзакции (pending, completed, failed) |
| orderId | string (optional) | ID связанного заказа |
| createdAt | timestamp | Дата и время создания транзакции |
| completedAt | timestamp (null) | Дата и время завершения транзакции |
| description | string | Описание транзакции |

## Аутентификация

Система аутентификации поддерживает следующие методы:

1. **Email + пароль** - традиционная аутентификация с проверкой email
2. **Google Account** - вход через учетную запись Google

### Безопасность

* Firebase Auth обеспечивает безопасное хранение учетных данных
* Правила безопасности Firestore настроены для ограничения доступа к данным на основе аутентификации
* Транзакции используются для атомарных операций с данными

## API для работы с базой данных

Основные функции для работы с базой данных реализованы в файле `js/db.js`. Они включают:

* `getCollection()` - получение данных из коллекции с опциональным запросом
* `getDocument()` - получение документа по ID
* `addDocument()` - добавление нового документа в коллекцию
* `updateDocument()` - обновление существующего документа
* `deleteDocument()` - удаление документа

Также имеются специализированные функции для работы с данными пользователя:

* `getUserNFTs()` - получение NFT пользователя
* `getUserOrders()` - получение заказов пользователя
* `getUserTransactions()` - получение транзакций пользователя
* `updateWalletConnection()` - обновление информации о подключении кошелька

## Интеграция с фронтендом

* Компоненты UI для входа и регистрации находятся в модальном окне авторизации
* Состояние пользователя отслеживается с помощью `auth.onAuthStateChanged()`
* Обновление UI при входе/выходе осуществляется через функции `updateUIOnAuth()` и `updateUIOnSignOut()` 